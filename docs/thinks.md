1. Проверить, что train и val бьються адекватно. 


балтика 0;[(0, 7, 'B-BRAND'), (8, 9, 'B-PERCENT')]
кефир 1%;[(0, 5, 'B-TYPE'), (6, 8, 'B-PERCENT')]
масло сливочное 72;[(0, 5, 'B-TYPE'), (6, 15, 'I-TYPE'), (16, 18, 'B-PERCENT')]
масло сливочное 82;[(0, 5, 'B-TYPE'), (6, 15, 'I-TYPE'), (16, 18, 'B-PERCENT')]
молоко 1 %;[(0, 6, 'B-TYPE'), (7, 8, 'B-PERCENT'), (9, 10, 'I-PERCENT')]
молоко 3,2;[(0, 6, 'B-TYPE'), (7, 10, 'B-PERCENT')]
молоко ультрапастеризованное 3.2;[(0, 6, 'B-TYPE'), (7, 28, 'I-TYPE'), (29, 32, 'B-PERCENT')]
мягкий творог 5%;[(0, 6, 'B-TYPE'), (7, 13, 'I-TYPE'), (14, 16, 'B-PERCENT')]
сливки 10;[(0, 6, 'B-TYPE'), (7, 9, 'B-PERCENT')]
сливки 10%;[(0, 6, 'B-TYPE'), (7, 10, 'B-PERCENT')]
сливки 20;[(0, 6, 'B-TYPE'), (7, 9, 'B-PERCENT')]
сливки 20%;[(0, 6, 'B-TYPE'), (7, 10, 'B-PERCENT')]
сливки 33;[(0, 6, 'B-TYPE'), (7, 9, 'B-PERCENT')]
сливки 33 %;[(0, 6, 'B-TYPE'), (7, 9, 'B-PERCENT'), (10, 11, 'I-PERCENT')]
сливки 33%;[(0, 6, 'B-TYPE'), (7, 10, 'B-PERCENT')]
смесь нестожен 3;[(0, 5, 'B-TYPE'), (6, 14, 'B-BRAND'), (15, 16, 'B-PERCENT')]
сметана 10;[(0, 7, 'B-TYPE'), (8, 10, 'B-PERCENT')]
сметана 10%;[(0, 7, 'B-TYPE'), (8, 11, 'B-PERCENT')]
сметана 15%;[(0, 7, 'B-TYPE'), (8, 11, 'B-PERCENT')]
сметана 20;[(0, 7, 'B-TYPE'), (8, 10, 'B-PERCENT')]
сметана 25;[(0, 7, 'B-TYPE'), (8, 10, 'B-PERCENT')]
сыр легкий 15%;[(0, 3, 'B-TYPE'), (4, 10, 'I-TYPE'), (11, 14, 'B-PERCENT')]
творог 1 %;[(0, 6, 'B-TYPE'), (7, 8, 'B-PERCENT'), (9, 10, 'I-PERCENT')]
творог 5%;[(0, 6, 'B-TYPE'), (7, 9, 'B-PERCENT')]
творог 9;[(0, 6, 'B-TYPE'), (7, 8, 'B-PERCENT')]
творог 9 %;[(0, 6, 'B-TYPE'), (7, 8, 'B-PERCENT'), (9, 10, 'I-PERCENT')]

Мысли:
1. Что если мы сделаем предпроцессинг - будем регулярными выражениями вырезать из запроса пользователя - сначала VOLUME и затем PERCENT и моделью будем детектть только принадлежность к классу TYPE или BRAND
2. Стоит выяить, бывают ли записи с BRAND но без TYPE (да есть)
3. Путаница будет между VOLUME и PERCENT в случаях когда написано просто число, например сметана 20 - это PERCENT, а бумага туалетная 12 - это VOLUME. Можно по каждой группе товара посчитать вероятности числа попасть в группу PERCENT или VOLUME. Например "сметана" встречается с записями %("сметана 10%")- значи число 20 в записи "сметана 20" - скорее будет означать 20%. А бумага туалетная не встречается с записями %, (или редко встречатся , можно выставить регулруеммый порог в 20%) значит число 12 в записи "бумага туалетная 12" - стоит относить к VOLUME.
Я посмотрел данны - статисчически не получиться посчитать для всех товаров. Нужно напренировать пмодель - которая будет определять - выставлять для товара VOLUME или PERCENT если указанно только число.  Так же стоит сделать исключение для число 0 - кажется это всегда %, если нет бругих числер или явных обозначений.  Так можно легко исправить записи с %. Какие еще могут быть варианты ?

Можно было бы использовать несколько моделей:
0. Определить явные признаки VOLUME и PERCENT через регулярные выражения.
1. Определить сложные случаи с числом в запросе (например: "сметана 10" -> "сметана 10%", "бумага туалетная 12" -> "бумага туалетная 12упаковок"). Через отдельную модель.
2. Модель1 Определяет принадлежность части запроса к классу TYPE и вырезает или помечает слово из запроса (нужно подумать как быть с I-TYPE)
3. Если остались неразмечанные участки: Модель2 Определяет принадлежностьчасти запроса к классу классу BRAND и вырезает или помечает слово из запроса (нужно подумать как быть с I-BRAND)
Еще есть нулевой класс O - стоит не забывать про него


План:
1. Вырезать из входных даных VOLUME и PERCENT через явные указатели "%, словарь VOLUME(шт, л, уп и т.д)"
2. Определить VOLUME и PERCENT для чисел без указателей
    1.1 Использовать словарь "Жирных" продуктов - сформировать его через модель
    1.2 Использовать диапозоны 0 - точно %



Per-type metrics (vs baseline):
  TYPE     P=0.9150  R=0.9618  F1=0.9378
  BRAND    P=0.8246  R=0.6997  F1=0.7571
  VOLUME   P=0.5000  R=0.3000  F1=0.3750
  PERCENT  P=0.0000  R=0.0000  F1=0.0000

Macro-F1 over types: 0.5175
Overall (micro)      P=0.8985  R=0.9051  F1=0.9018

Examples of mismatches (first 20):
— sample: abso
  gold: [('BRAND', 0, 4)]
  pred: []

— sample: ahma
  gold: [('BRAND', 0, 4)]
  pred: []

— sample: akba
  gold: [('BRAND', 0, 4)]
  pred: [('BRAND', 2, 4)]

— sample: alen
  gold: [('BRAND', 0, 4)]
  pred: [('BRAND', 3, 4)]

— sample: almeta
  gold: [('BRAND', 0, 6)]
  pred: [('BRAND', 2, 6)]

— sample: aloe
  gold: [('TYPE', 0, 4)]
  pred: [('BRAND', 2, 4)]

— sample: asileorovskoe
  gold: []
  pred: [('BRAND', 0, 13)]

— sample: aunfed
  gold: []
  pred: [('BRAND', 0, 6)]

— sample: avyanka
  gold: []
  pred: [('BRAND', 0, 7)]

— sample: b-brand с клубникой
  gold: [('BRAND', 0, 7)]
  pred: []

— sample: black
  gold: [('BRAND', 0, 5)]
  pred: []

— sample: bodyr
  gold: []
  pred: [('BRAND', 0, 5)]

— sample: ceany
  gold: []
  pred: [('BRAND', 0, 5)]

— sample: cof
  gold: [('TYPE', 0, 3)]
  pred: [('BRAND', 0, 3)]

— sample: coffe
  gold: [('TYPE', 0, 5)]
  pred: [('BRAND', 0, 5)]

— sample: creme
  gold: [('TYPE', 0, 5)]
  pred: []

— sample: crispy
  gold: [('TYPE', 0, 6)]
  pred: [('BRAND', 1, 6)]

— sample: desser
  gold: [('TYPE', 0, 6)]
  pred: [('BRAND', 0, 6)]

— sample: energy кофеварок
  gold: [('BRAND', 0, 6), ('TYPE', 7, 16)]
  pred: [('TYPE', 7, 16)]

— sample: fairyǰ
  gold: [('BRAND', 0, 6)]
  pred: [('TYPE', 0, 6)]

(.venv) (base) contender@MacBook-Pro-Denis x5-ner % 


Не могу сообразить. improved_preprocessing.py размечает так: 
балтика 0 [(0, 7, 'B-BRAND'), (8, 9, 'B-PERCENT')] => [(8, 9, 'B-PERCENT')]
кефир 1% [(0, 5, 'B-TYPE'), (6, 8, 'B-PERCENT')] => [(6, 8, 'B-PERCENT')]
масло сливочное 72 [(0, 5, 'B-TYPE'), (6, 15, 'I-TYPE'), (16, 18, 'B-PERCENT')] => [(16, 18, 'B-PERCENT')]
масло сливочное 82 [(0, 5, 'B-TYPE'), (6, 15, 'I-TYPE'), (16, 18, 'B-PERCENT')] => [(16, 18, 'B-PERCENT')]

А после postprocess.py c флагом do_boost_numeric я получаю
sample,gold,pred,mismatch_spans
балтика 0,"[(0, 7, 'B-BRAND'), (8, 9, 'B-PERCENT')]","[(0, 7, 'B-TYPE'), (8, 9, 'B-VOLUME')]"
молоко ультрапастеризованное 3.2,"[(0, 6, 'B-TYPE'), (7, 28, 'I-TYPE'), (29, 32, 'B-PERCENT')]","[(0, 6, 'B-TYPE'), (7, 28, 'B-TYPE'), (29, 32, 'B-VOLUME')]","[(29, 32)]"
молоко ультрапастеризованное 3.2,"[(0, 6, 'B-TYPE'), (7, 28, 'I-TYPE'), (29, 32, 'B-PERCENT')]","[(0, 6, 'B-TYPE'), (7, 28, 'B-TYPE'), (29, 32, 'B-VOLUME')]","[(29, 32)]"


sample,gold,pred,mismatch_spans
"молоко 3,2","[(0, 6, 'B-TYPE'), (7, 10, 'B-PERCENT')]","[(0, 6, 'B-TYPE'), (8, 9, 'B-TYPE')]","[(7, 10)]"

В запросе "молоко 3,2" 3,2 - определилось моделью как продолжение B-TYPE, поэтому при мерже, мы не стали накладывать PECRENT
может быть есть смысл добавить какое-то правило, что бы закрыть такие случаи:
Например: если B-TYPE - целое число или число с плавающей точкой - то это скорее всего PERCENT


